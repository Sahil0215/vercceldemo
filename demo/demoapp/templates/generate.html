<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Invoice</title>
    <script>
        function generateItemFields() {
            const container = document.getElementById('itemFields');
            const numberOfItems = document.getElementById('no_of_items').value;
            container.innerHTML = ''; // Clear existing fields

            for (let i = 0; i < numberOfItems; i++) {
                // Create item dropdown
                let itemLabel = document.createElement('label');
                itemLabel.innerHTML = `Item ${i + 1}: `;
                container.appendChild(itemLabel);

                let itemSelect = document.createElement('select');
                itemSelect.name = `item_${i}`;

                // Populate the select options with items
                items.forEach(item => {
                    let option = document.createElement('option');
                    option.value = item.id;
                    option.innerHTML = item.name;
                    itemSelect.appendChild(option);
                });
                container.appendChild(itemSelect);

                // Create rate input
                let rateLabel = document.createElement('label');
                rateLabel.innerHTML = ` Rate ${i + 1}: `;
                container.appendChild(rateLabel);

                let rateInput = document.createElement('input');
                rateInput.type = 'number';
                rateInput.name = `rate_${i}`;
                rateInput.required = true;
                container.appendChild(rateInput);

                // Create quantity input
                let quantityLabel = document.createElement('label');
                quantityLabel.innerHTML = ` Quantity ${i + 1}: `;
                container.appendChild(quantityLabel);

                let quantityInput = document.createElement('input');
                quantityInput.type = 'number';
                quantityInput.name = `quantity_${i}`;
                quantityInput.required = true;
                container.appendChild(quantityInput);

                container.appendChild(document.createElement('br'));
            }
        }

        // This variable will be populated by the Django template
        let items = [];
    </script>
</head>
<body>
    <h1>Generate Invoice</h1>
    <form method="POST">
        {% csrf_token %}
        <label for="bill_no">Bill NO:</label>
        <input type="number" id="bill_no" name="bill_no" required><br>

        <label for="date">Date:</label>
        <input type="date" id="date" name="date" required><br>

        <label for="bill_from">From (Seller):</label>
        <select id="bill_from" name="bill_from">
            {% for seller in sellers %}
                <option value="{{ seller.id }}">{{ seller.name }}</option>
            {% endfor %}
        </select><br>

        <label for="bill_to">To (Buyer):</label>
        <select id="bill_to" name="bill_to">
            {% for buyer in buyers %}
                <option value="{{ buyer.id }}">{{ buyer.name }}</option>
            {% endfor %}
        </select><br>

        <label for="no_of_items">No of Items:</label>
        <input type="number" id="no_of_items" name="no_of_items" required onchange="generateItemFields()"><br>

        <div id="itemFields"></div>

        <label for="transport">Transport:</label>
        <input type="text" id="transport" name="transport"><br>

        <label for="eway">E-way:</label>
        <input type="text" id="eway" name="eway" required><br>

        <label for="vehicle_no">Vehicle No:</label>
        <input type="text" id="vehicle_no" name="vehicle_no" required><br>

        <label for="discount">Discount:</label>
        <input type="number" id="discount" name="discount" required><br>

        <label for="grand_total">Total:</label>
        <input type="number" step="0.01" id="grand_total" name="grand_total" required><br>

        <button type="submit">Generate Invoice</button>
    </form>

    <script>
        // Pass Django context items to JavaScript
        items = JSON.parse('{{ items_json|escapejs }}');
    </script>
</body>
</html>
